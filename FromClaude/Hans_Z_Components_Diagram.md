# Hans Z-Correction: ะะฐะบ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั Z ะดะปั ะดะธะฐะผะตััะฐ ะธ ะบะพััะตะบัะธั ะฟะพะปั

## ๐ฏ ะัะฐัะบะธะน ะพัะฒะตั

**ะกะะะะะซะะะขะฌ** ะฒัะต Z-ะบะพะผะฟะพะฝะตะฝัั:

```
Z_total = z_diameter + z_field + z_static
```

---

## ๐ ะะธะทัะฐะปัะฝะฐั ััะตะผะฐ

```
                        CLI Parameter
                  "laser_beam_diameter": 80.0 ฮผm
                               โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ  z_diameter = f(CLI_diameter)           โ
         โ  z_diameter = 1.894 mm                  โ
         โ  (ะพะดะธะฝะฐะบะพะฒัะน ะดะปั ะฒัะตะณะพ ัะตะณะธะพะฝะฐ)         โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               +  โ ะกะะะะะขะฌ
                               โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ  z_field = Aรrยฒ + Bรr + C               โ
         โ  ะณะดะต r = sqrt(xยฒ + yยฒ)                  โ
         โ  z_field(0,0)   = -7.506 mm  (ัะตะฝัั)    โ
         โ  z_field(200,0) = -4.720 mm  (ะบัะฐะน)     โ
         โ  (ัะฐะทะฝัะน ะดะปั ะบะฐะถะดะพะน ัะพัะบะธ)              โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               +  โ ะกะะะะะขะฌ
                               โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ  z_static = -0.001 mm                   โ
         โ  (ะธะท scannerConfig.offsetZ)             โ
         โ  (ะพะดะธะฝะฐะบะพะฒัะน ะดะปั ะฒัะตะน ัะธััะตะผั)          โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ  Z_total = 1.894 + z_field + (-0.001)   โ
         โ                                          โ
         โ  ะฆะตะฝัั (0,0):   -5.613 mm                โ
         โ  ะัะฐะน (200,0):  -2.827 mm                โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                   structUdmPos { x, y, z = Z_total }
                               โ
                    UDM_AddPolyline3D(...)
```

---

## ๐ง ะคะธะทะธัะตัะบะธะน ัะผััะป ะบะฐะถะดะพะน ะบะพะผะฟะพะฝะตะฝัั

### 1๏ธโฃ `z_diameter` - ะฃะฟัะฐะฒะปะตะฝะธะต ะดะธะฐะผะตััะพะผ ะปััะฐ

```
CLI: "ะัะถะตะฝ ะดะธะฐะผะตัั 80 ฮผm"
       โ
z_diameter = +1.894 mm
       โ
ะคะพะบัั ัะผะตัะฐะตััั ะฝะฐ 1.894 ะผะผ ะะะะ ัะฐะฑะพัะตะน ะฟะปะพัะบะพััะธ
       โ
ะัั ัะฐััะพะดะธััั โ ะดะธะฐะผะตัั ะฟััะฝะฐ = 80 ฮผm
```

**ะะดะธะฝะฐะบะพะฒัะน** ะดะปั ะฒัะตั ัะพัะตะบ ัะตะณะธะพะฝะฐ (ัะธะบัะธัะพะฒะฐะฝะฝัะน ะดะธะฐะผะตัั).

---

### 2๏ธโฃ `z_field` - ะะพััะตะบัะธั ะบัะธะฒะธะทะฝั F-theta ะปะธะฝะทั

F-theta ะปะธะฝะทะฐ ะธะผะตะตั **ะบัะธะฒะธะทะฝั ะฟะพะปั** - ัะพะบะฐะปัะฝะฐั ะฟะปะพัะบะพััั ะฝะต ะฟะปะพัะบะฐั!

```
        ะะดะตะฐะปัะฝะฐั ะฟะปะพัะบะพััั (ะณะดะต ะดะพะปะถะฝะฐ ะฑััั ะดะตัะฐะปั)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โฑ                           โฒ
          โฑ        ะะตะฐะปัะฝะฐั             โฒ
         โฑ      ัะพะบะฐะปัะฝะฐั                โฒ
        โฑ       ะฟะปะพัะบะพััั                 โฒ
       โฑ       (ะธะทะพะณะฝััะฐ)                  โฒ
      โผ                                     โผ
   ะฆะตะฝัั                                  ะัะฐะน
  (r=0)                                  (r=200)
```

**ะะตัะตะฝะธะต:** ะะปั ะบะฐะถะดะพะน ัะพัะบะธ (x, y) ะดะพะฑะฐะฒะธัั ะธะฝะดะธะฒะธะดัะฐะปัะฝัั ะบะพััะตะบัะธั:

```
r = sqrt(xยฒ + yยฒ)
z_field = Bรr + C

ะฆะตะฝัั (r=0):     z_field = C = -7.506 mm
ะัะฐะน (r=200):    z_field = 0.0139ร200 - 7.506 = -4.720 mm
ะะฐะทะฝะธัะฐ: ~2.8 mm  โ ะญัะพ ะธ ะตััั ะบัะธะฒะธะทะฝะฐ!
```

**ะะฐะทะฝัะน** ะดะปั ะบะฐะถะดะพะน ัะพัะบะธ (ะบะพะผะฟะตะฝัะฐัะธั ะบัะธะฒะธะทะฝั).

---

### 3๏ธโฃ `z_static` - ะกัะฐัะธัะตัะบะฐั ะบะฐะปะธะฑัะพะฒะบะฐ

ะะฑัะตะต ัะผะตัะตะฝะธะต ะฒัะตะน ัะธััะตะผั, ัััะฐะฝะฐะฒะปะธะฒะฐะตััั ะฟัะธ ะบะฐะปะธะฑัะพะฒะบะต ะผะฐัะธะฝั.

```
z_static = -0.001 mm  (ะฟะพััะธ ะฝะพะปั, ะผะธะบัะพะฟะพะดัััะพะนะบะฐ)
```

**ะะดะธะฝะฐะบะพะฒัะน** ะดะปั ะฒัะตะน ัะธััะตะผั.

---

## ๐งฎ ะัะธะผะตั ัะฐััะตัะฐ

### ะััะพะดะฝัะต ะดะฐะฝะฝัะต:

- CLI: `laser_beam_diameter = 80.0 ฮผm`
- BeamConfig: `dโ = 48.141 ฮผm`, `z_R = 1426.715 ฮผm`
- ThirdAxis: `B = 0.0139`, `C = -7.506`
- ScannerConfig: `offsetZ = -0.001 mm`

### ะขะพัะบะฐ ะฒ ัะตะฝััะต ะฟะพะปั (0, 0):

```
1. z_diameter = 1426.715 ร sqrt((80/48.141)ยฒ - 1) / 1000
             = 1.894 mm

2. r = sqrt(0ยฒ + 0ยฒ) = 0
   z_field = 0.0139 ร 0 + (-7.506) = -7.506 mm

3. z_static = -0.001 mm

4. Z_total = 1.894 + (-7.506) + (-0.001)
           = -5.613 mm
```

### ะขะพัะบะฐ ะฝะฐ ะบัะฐั ะฟะพะปั (200, 0):

```
1. z_diameter = 1.894 mm  (ัะฐะบะพะน ะถะต!)

2. r = sqrt(200ยฒ + 0ยฒ) = 200
   z_field = 0.0139 ร 200 + (-7.506) = -4.720 mm  (ะดััะณะพะน!)

3. z_static = -0.001 mm

4. Z_total = 1.894 + (-4.720) + (-0.001)
           = -2.827 mm  (ะดััะณะพะน!)
```

**ะะฐะทะฝะธัะฐ:** `-5.613 - (-2.827) = -2.786 mm`

ะญัะฐ ัะฐะทะฝะธัะฐ **ะบะพะผะฟะตะฝัะธััะตั** ะบัะธะฒะธะทะฝั ะฟะพะปั!

---

## ๐ป ะะตะฐะปะธะทะฐัะธั ะฒ ะบะพะดะต

### ะะปั ะะะะะะ ัะพัะบะธ ะณะตะพะผะตััะธะธ:

```csharp
// 1. ะะฐัััะธัะฐัั z_diameter ะะะะ ะะะ ะดะปั ัะตะณะธะพะฝะฐ
float z_diameter = beamConfig.CalculateZOffset(cliDiameter);

// 2. ะะปั ะะะะะะ ัะพัะบะธ (x, y):
foreach (var point in geometryPoints)
{
    float x = point.X;
    float y = point.Y;

    // ะะฐัััะธัะฐัั z_field ะดะปั ะญะขะะ ัะพัะบะธ
    float z_field = thirdAxis.CalculateFieldCorrection(x, y);

    // ะกะปะพะถะธัั ะฒัะต ะบะพะผะฟะพะฝะตะฝัั
    float z_total = z_diameter + z_field + (float)staticOffsetZ;

    // ะกะพะทะดะฐัั ัะพัะบั ะดะปั Hans
    structUdmPos hansPoint = new structUdmPos
    {
        x = x,
        y = y,
        z = z_total  // โ ะัะพะณะพะฒัะน Z (ะธะฝะดะธะฒะธะดัะฐะปัะฝัะน ะดะปั ัะพัะบะธ!)
    };

    hansPoints.Add(hansPoint);
}

// 3. ะัะฟัะฐะฒะธัั ะฒ Hans
HM_UDM_DLL.UDM_AddPolyline3D(hansPoints.ToArray(), hansPoints.Count, layerIndex);
```

---

## ๐ ะขะฐะฑะปะธัะฐ: Z ะดะปั ัะฐะทะฝัั ัะพัะตะบ

ะะปั ัะตะณะธะพะฝะฐ ั CLI diameter = 80 ฮผm:

| Position (x, y) | r (mm) | z_diameter | z_field | z_static | **Z_total** |
|----------------|--------|------------|---------|----------|-------------|
| (0, 0) | 0 | 1.894 | -7.506 | -0.001 | **-5.613** |
| (50, 0) | 50 | 1.894 | -6.810 | -0.001 | **-4.917** |
| (100, 0) | 100 | 1.894 | -6.113 | -0.001 | **-4.220** |
| (150, 0) | 150 | 1.894 | -5.417 | -0.001 | **-3.524** |
| (200, 0) | 200 | 1.894 | -4.720 | -0.001 | **-2.827** |
| (141, 141) | 200 | 1.894 | -4.720 | -0.001 | **-2.827** |

**ะะธะดะฝะพ:** ะงะตะผ ะดะฐะปััะต ะพั ัะตะฝััะฐ, ัะตะผ **ะผะตะฝััะต** ะพััะธัะฐัะตะปัะฝะพะต Z (ะฑะปะธะถะต ะบ ะฝัะปั).

---

## โ FAQ

### Q: ะะพัะตะผั ะฝะตะปัะทั ะธัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ z_diameter?

**A:** ะะพัะพะผั ััะพ F-theta ะปะธะฝะทะฐ ะธะผะตะตั ะบัะธะฒะธะทะฝั. ะัะปะธ ะฝะต ะบะพะผะฟะตะฝัะธัะพะฒะฐัั:
- ะ ัะตะฝััะต ะฟะพะปั ัะพะบัั ะฑัะดะตั ะฝะธะถะต ะฝะฐ 2.8 ะผะผ, ัะตะผ ะฝะฐ ะบัะฐั
- ะะฐัะตััะฒะพ ะฟะตัะฐัะธ ะฑัะดะตั ะฝะตัะฐะฒะฝะพะผะตัะฝัะผ
- ะะฐ ะบัะฐั ะฟะพะปั ะดะธะฐะผะตัั ะฑัะดะตั ะฝะตะฟัะฐะฒะธะปัะฝัะผ

### Q: ะะพัะตะผั ะฝะตะปัะทั ะธัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ z_field?

**A:** ะะพัะพะผั ััะพ ัะพะณะดะฐ ะดะธะฐะผะตัั ะปััะฐ ะฑัะดะตั ะผะธะฝะธะผะฐะปัะฝัะผ (dโ = 48.141 ฮผm) ะฒะผะตััะพ ััะตะฑัะตะผะพะณะพ 80 ฮผm.

### Q: ะัะถะฝะพ ะปะธ ะฟะตัะตััะธััะฒะฐัั z_diameter ะดะปั ะบะฐะถะดะพะน ัะพัะบะธ?

**A:** ะะะข! `z_diameter` ัะฐัััะธััะฒะฐะตััั **ะพะดะธะฝ ัะฐะท** ะดะปั ะฒัะตะณะพ ัะตะณะธะพะฝะฐ.
ะขะพะปัะบะพ `z_field` ัะฐัััะธััะฒะฐะตััั ะดะปั ะบะฐะถะดะพะน ัะพัะบะธ.

### Q: ะงัะพ ะตัะปะธ z_static = 0?

**A:** ะขะพะณะดะฐ ะฟัะพััะพ `Z_total = z_diameter + z_field`. ะญัะพ ะฝะพัะผะฐะปัะฝะพ.

### Q: ะะพะณะดะฐ z_field ะฑะพะปััะต ะฒัะตะณะพ?

**A:** ะฃ **ัะตะฝััะฐ** ะฟะพะปั (0, 0) - ัะฐะผ ัะฐะผะพะต ะฑะพะปััะพะต **ะพััะธัะฐัะตะปัะฝะพะต** ะทะฝะฐัะตะฝะธะต.
ะฃ ะบัะฐั ะฟะพะปั z_field ะฑะปะธะถะต ะบ ะฝัะปั.

### Q: ะงัะพ ะดะตะปะฐะตั ัะพัะผัะปะฐ `Bรr + C`?

**A:**
- `C` - ัะผะตัะตะฝะธะต ะฒ ัะตะฝััะต ะฟะพะปั
- `Bรr` - ะปะธะฝะตะนะฝะฐั ะบะพััะตะบัะธั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะฐัััะพัะฝะธั ะพั ัะตะฝััะฐ
- ะงะตะผ ะดะฐะปััะต ะพั ัะตะฝััะฐ (`r` ะฑะพะปััะต), ัะตะผ ะผะตะฝััะต ะบะพััะตะบัะธั (ะฑะปะธะถะต ะบ ะฝัะปั)

---

## ๐ฏ ะัะพะณะพะฒะฐั ัะพัะผัะปะฐ

```
Z_total(x, y) = z_diameter + z_field(x, y) + z_static

ะณะดะต:
  z_diameter = f(CLI_diameter) = const ะดะปั ัะตะณะธะพะฝะฐ
  z_field(x, y) = B ร sqrt(xยฒ + yยฒ) + C  (ะธะฝะดะธะฒะธะดัะฐะปัะฝะพ)
  z_static = const ะดะปั ัะธััะตะผั
```

---

## โ Checklist

- [ ] ะะฐัััะธัะฐัั `z_diameter` ะพะดะธะฝ ัะฐะท ะดะปั ัะตะณะธะพะฝะฐ
- [ ] ะะปั ะบะฐะถะดะพะน ัะพัะบะธ ัะฐัััะธัะฐัั `z_field(x, y)`
- [ ] ะกะปะพะถะธัั `z_total = z_diameter + z_field + z_static`
- [ ] ะฃััะฐะฝะพะฒะธัั `structUdmPos.z = z_total`
- [ ] ะะพะฒัะพัะธัั ะดะปั ะฒัะตั ัะพัะตะบ
- [ ] ะัะฟัะฐะฒะธัั ะฒ `UDM_AddPolyline3D`

---

## ๐ ะกะฒัะทะฐะฝะฝัะต ัะฐะนะปั

- **[Hans_Z_Correction_Explained.cs](Hans_Z_Correction_Explained.cs)** - ะฟะพะดัะพะฑะฝัะต ะฟัะธะผะตัั ั ะฒัะฒะพะดะพะผ
- **[Hans_DualLaser_CLI_Example.cs](Hans_DualLaser_CLI_Example.cs)** - ะฟะพะปะฝะฐั ัะตะฐะปะธะทะฐัะธั
- **[Hans_BeamConfig_Analysis.md](Hans_BeamConfig_Analysis.md)** - ะดะตัะฐะปัะฝัะน ะฐะฝะฐะปะธะท

---

**ะะตััะธั:** 1.0
**ะะฐัะฐ:** 2025
