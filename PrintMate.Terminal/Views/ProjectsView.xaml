<UserControl x:Class="PrintMate.Terminal.Views.ProjectsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:PrintMate.Terminal.Views"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             mc:Ignorable="d"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             d:DesignHeight="1080" d:DesignWidth="1410">

    <UserControl.Resources>
        <!-- Стиль карточки проекта (без Effect для чёткости текста) -->
        <Style x:Key="ProjectCardStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#141414" Offset="0"/>
                        <GradientStop Color="#0f0f0f" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#1f1f1f"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <!-- DropShadowEffect убран - он вызывает размытие текста в WPF -->
        </Style>

        <!-- Стиль для иконки-индикатора -->
        <Style x:Key="StatIconStyle" TargetType="Path">
            <Setter Property="Width" Value="16"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="Fill" Value="#ff6f00"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Стиль метки статистики -->
        <Style x:Key="StatLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#606060"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Стиль значения статистики -->
        <Style x:Key="StatValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#c0c0c0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#080808" Offset="0"/>
                <GradientStop Color="#0a0a0a" Offset="0.5"/>
                <GradientStop Color="#060606" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ============== ШАПКА ============== -->
        <Border Grid.Row="0" Padding="40 30">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#0d0d0d" Offset="0"/>
                    <GradientStop Color="#090909" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Левая часть - заголовок -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <!-- Иконка папки -->
                        <Border Width="50" Height="50" CornerRadius="12" Margin="0 0 20 0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#1a1208" Offset="0"/>
                                    <GradientStop Color="#0f0a04" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Path Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                                  Fill="#ff6f00" Width="24" Height="24" Stretch="Uniform"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <StackPanel VerticalAlignment="Center">
                            <TextBlock FontSize="28" FontWeight="Bold" Margin="0 0 0 2">
                                <TextBlock.Foreground>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#ffffff" Offset="0"/>
                                        <GradientStop Color="#e0e0e0" Offset="1"/>
                                    </LinearGradientBrush>
                                </TextBlock.Foreground>
                                Проекты
                            </TextBlock>
                            <TextBlock Text="Управление файлами печати" FontSize="13" Foreground="#505050"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Правая часть - кнопка загрузки -->
                <Button Grid.Column="2"
                        Click="ButtonBase_OnClick"
                        Width="180" Height="48"
                        Cursor="Hand"
                        FocusVisualStyle="{x:Null}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="ButtonBorder" CornerRadius="12" BorderThickness="0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#ff6f00" Offset="0"/>
                                        <GradientStop Color="#e65c00" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5" Color="#ff6f00"/>
                                </Border.Effect>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Path Data="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"
                                          Fill="White" Width="18" Height="18" Stretch="Uniform" Margin="0 0 10 0"/>
                                    <TextBlock Text="Загрузить" FontSize="15" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>

                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#ff8533" Offset="0"/>
                                                <GradientStop Color="#ff6f00" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter TargetName="ButtonBorder" Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.7" Color="#ff6f00"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#cc5500" Offset="0"/>
                                                <GradientStop Color="#b34700" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>

        <!-- Разделительная линия с градиентом -->
        <Border Grid.Row="0" VerticalAlignment="Bottom" Height="1">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="Transparent" Offset="0"/>
                    <GradientStop Color="#ff6f00" Offset="0.2"/>
                    <GradientStop Color="#ff6f00" Offset="0.8"/>
                    <GradientStop Color="Transparent" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
        </Border>

        <!-- ============== КОНТЕНТ С КАРТОЧКАМИ ============== -->
        <ScrollViewer x:Name="ProjectsScrollViewer"
                      Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Background="Transparent"
                      Padding="30 25"
                      Visibility="{Binding UsersListVisibility}">

            <ItemsControl ItemsSource="{Binding Projects}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <!-- Сетка карточек: 3 колонки -->
                        <UniformGrid Columns="3" HorizontalAlignment="Stretch"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="CardBorder"
                                Style="{StaticResource ProjectCardStyle}"
                                Margin="10"
                                Padding="0">

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Верхняя часть карточки - превью/иконка -->
                                <Border Grid.Row="0" Height="120" CornerRadius="16 16 0 0" ClipToBounds="True">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#1a1005" Offset="0"/>
                                            <GradientStop Color="#0d0803" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>

                                    <Grid>
                                        <!-- Декоративные элементы -->
                                        <Ellipse Width="200" Height="200" Opacity="0.08"
                                                 HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                 Margin="0 0 -60 -100">
                                            <Ellipse.Fill>
                                                <RadialGradientBrush>
                                                    <GradientStop Color="#ff6f00" Offset="0"/>
                                                    <GradientStop Color="Transparent" Offset="1"/>
                                                </RadialGradientBrush>
                                            </Ellipse.Fill>
                                        </Ellipse>

                                        <!-- Большая иконка 3D-модели -->
                                        <Border Width="60" Height="60" CornerRadius="15"
                                                HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#ff6f00" Offset="0"/>
                                                    <GradientStop Color="#cc5500" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <!-- Иконка куба/3D -->
                                            <Path Data="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15L6.04 7.5 12 10.85l5.96-3.35L12 4.15zM5 15.91l6 3.38v-6.71L5 9.21v6.7zm14 0v-6.7l-6 3.37v6.71l6-3.38z"
                                                  Fill="White" Width="28" Height="28" Stretch="Uniform"
                                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- ID проекта в углу -->
                                        <Border CornerRadius="8" Padding="8 4"
                                                HorizontalAlignment="Left" VerticalAlignment="Top" Margin="12">
                                            <Border.Background>
                                                <SolidColorBrush Color="#000000" Opacity="0.5"/>
                                            </Border.Background>
                                            <TextBlock FontSize="11" FontWeight="Bold" Foreground="#808080">
                                                <Run Text="#"/>
                                                <Run Text="{Binding Id}"/>
                                            </TextBlock>
                                        </Border>

                                        <!-- Тип проекта -->
                                        <Border CornerRadius="8" Padding="10 5"
                                                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="12">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#ff6f00" Offset="0"/>
                                                    <GradientStop Color="#e65c00" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <TextBlock Text="{Binding ProjectType}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                        </Border>
                                    </Grid>
                                </Border>

                                <!-- Средняя часть - информация -->
                                <StackPanel Grid.Row="1" Margin="20 18 20 12">
                                    <!-- Название проекта -->
                                    <TextBlock Text="{Binding Name}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="White"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding Name}"/>

                                    <!-- Путь к файлу -->
                                    <TextBlock Text="{Binding Path}"
                                               FontSize="11"
                                               Foreground="#404040"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0 4 0 0"
                                               ToolTip="{Binding Path}"/>

                                    <!-- Разделитель -->
                                    <Border Height="1" Margin="0 14 0 14">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                <GradientStop Color="#1f1f1f" Offset="0"/>
                                                <GradientStop Color="#2a2a2a" Offset="0.5"/>
                                                <GradientStop Color="#1f1f1f" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>

                                    <!-- Статистика - сетка 2x2 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Высота изделия -->
                                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0 0 0 12">
                                            <StackPanel Orientation="Horizontal" Margin="0 0 0 3">
                                                <Path Style="{StaticResource StatIconStyle}" Margin="0 0 6 0"
                                                      Data="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                                                <TextBlock Text="Высота" Style="{StaticResource StatLabelStyle}"/>
                                            </StackPanel>
                                            <TextBlock Style="{StaticResource StatValueStyle}">
                                                <Run Text="{Binding ProjectHeight, StringFormat={}{0:F2}}"/>
                                                <Run Text="мм" Foreground="#505050"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Толщина слоя -->
                                        <StackPanel Grid.Row="1" Grid.Column="0">
                                            <StackPanel Orientation="Horizontal" Margin="0 0 0 3">
                                                <Path Style="{StaticResource StatIconStyle}" Margin="0 0 6 0"
                                                      Data="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/>
                                                <TextBlock Text="Толщина слоя" Style="{StaticResource StatLabelStyle}"/>
                                            </StackPanel>
                                            <TextBlock Style="{StaticResource StatValueStyle}">
                                                <Run Text="{Binding LayerSliceHeight, StringFormat={}{0:F3}}"/>
                                                <Run Text="мм" Foreground="#505050"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Количество слоев -->
                                        <StackPanel Grid.Row="1" Grid.Column="1">
                                            <StackPanel Orientation="Horizontal" Margin="0 0 0 3">
                                                <Path Style="{StaticResource StatIconStyle}" Margin="0 0 6 0"
                                                      Data="M4 18h3V5H4v13zM18 5v13h3V5h-3zM8 18h9V5H8v13z"/>
                                                <TextBlock Text="Слоёв" Style="{StaticResource StatLabelStyle}"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding LayersCount}" Style="{StaticResource StatValueStyle}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <!-- Нижняя часть - материал и действия -->
                                <Border Grid.Row="2" Padding="16 12" CornerRadius="0 0 16 16">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#0c0c0c" Offset="0"/>
                                            <GradientStop Color="#0a0a0a" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Материал -->
                                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                            <Border Width="28" Height="28" CornerRadius="7" Margin="0 0 10 0">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#1a1a1a" Offset="0"/>
                                                        <GradientStop Color="#121212" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                                      Fill="#4CAF50" Width="14" Height="14" Stretch="Uniform"
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="Материал" FontSize="10" Foreground="#505050"/>
                                                <TextBlock Text="{Binding MaterialName}" FontSize="12" FontWeight="SemiBold" Foreground="#909090"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Кнопка открытия -->
                                        <Border x:Name="OpenButton" Grid.Column="1"
                                                Width="36" Height="36" CornerRadius="10" Cursor="Hand">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#1a1a1a" Offset="0"/>
                                                    <GradientStop Color="#141414" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <Path Data="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"
                                                  Fill="#606060" Width="16" Height="16" Stretch="Uniform"
                                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </Grid>

                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                                    <i:InvokeCommandAction
                                        Command="{Binding DataContext.SelectProject, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </Border>

                        <DataTemplate.Triggers>
                            <!-- Hover эффект на карточку (без DropShadowEffect для чёткости текста) -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CardBorder" Property="BorderBrush" Value="#ff6f00"/>
                                <Setter TargetName="CardBorder" Property="BorderThickness" Value="2"/>
                                <Setter TargetName="OpenButton" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#ff6f00" Offset="0"/>
                                            <GradientStop Color="#e65c00" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Пустое состояние (когда нет проектов) -->
        <StackPanel Grid.Row="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{Binding EmptyStateVisibility, FallbackValue=Collapsed}">

            <!-- Иконка -->
            <Border Width="100" Height="100" CornerRadius="25" Margin="0 0 0 25">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1a1208" Offset="0"/>
                        <GradientStop Color="#0f0a04" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                <Path Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                      Fill="#ff6f00" Width="44" Height="44" Stretch="Uniform" Opacity="0.6"
                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>

            <TextBlock Text="Нет проектов" FontSize="22" FontWeight="Bold" Foreground="#404040" HorizontalAlignment="Center"/>
            <TextBlock Text="Загрузите проект, чтобы начать работу" FontSize="14" Foreground="#303030" HorizontalAlignment="Center" Margin="0 8 0 0"/>
        </StackPanel>
    </Grid>
</UserControl>
