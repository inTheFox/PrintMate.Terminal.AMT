<UserControl x:Class="LogViewerApp.Views.MainView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:converters="clr-namespace:LogViewerApp.Converters"
             xmlns:models="clr-namespace:LogViewerApp.Models"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="#0C0C0C">

    <UserControl.Resources>
        <converters:LogLevelToBrushConverter x:Key="LogLevelToBrushConverter"/>

        <Style x:Key="LogLevelComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource ComboBoxExtend}">
            <Setter Property="MinWidth" Value="150"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Vertical">
                <TextBlock Text="Am.Tech logging viewer"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"/>
                <TextBlock Text="ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸"
                           FontSize="14"
                           FontFamily="Consolas"
                           Foreground="#808080"
                           Margin="0,5,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Border Background="{Binding ConnectionStatusColor}"
                        CornerRadius="10"
                        Padding="15,8"
                        Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Fill="White"
                                 Width="8"
                                 Height="8"
                                 Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding ConnectionStatusText}"
                                   Foreground="White"
                                   FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>

                <Button Content="ðŸ”„ ÐŸÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ"
                        Command="{Binding ReconnectCommand}"
                        Style="{StaticResource ButtonPrimary}"
                        Margin="0,0,10,0"/>

                <Button Content="ðŸ—‘ ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ"
                        Command="{Binding ClearLogsCommand}"
                        Style="{StaticResource ButtonWarning}"/>
            </StackPanel>
        </Grid>

        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² -->
        <hc:Card Grid.Row="1" Margin="0,0,0,15" Padding="15" Background="#1E1E1E">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ð”Ð°Ñ‚Ð° -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Ð”Ð°Ñ‚Ð°:"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               Foreground="White"
                               FontWeight="SemiBold"/>
                    <DatePicker SelectedDate="{Binding SelectedDate, Mode=TwoWay}"
                                Width="150"
                                Background="#2D2D30"
                                Margin="5"
                                Foreground="White"/>
                </StackPanel>

                <!-- ÐŸÐ¾Ð¸ÑÐº -->
                <TextBlock Grid.Column="1"
                           Text="ÐŸÐ¾Ð¸ÑÐº:"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"
                           Foreground="White"
                           FontWeight="SemiBold"/>

                <hc:SearchBar Grid.Column="2"
                              Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                              hc:InfoElement.Placeholder="ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑŽ, ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¸Ð»Ð¸ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÑŽ..."
                              Margin="0,5,20,5"/>

                <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑŽ -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,0,15,0">
                    <TextBlock Text="ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ:"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding Applications}"
                              Margin="5"
                              SelectedItem="{Binding SelectedApplication}"
                              Style="{StaticResource LogLevelComboBoxStyle}"
                              MinWidth="180"/>
                </StackPanel>

                <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="0,0,15,0">
                    <TextBlock Text="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ:"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding Categories}"
                              Margin="5"
                              SelectedItem="{Binding SelectedCategory}"
                              Style="{StaticResource LogLevelComboBoxStyle}"
                              MinWidth="180"/>
                </StackPanel>

                <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ SessionId -->
                <StackPanel Grid.Column="5" Orientation="Horizontal" Margin="0,0,15,0">
                    <TextBlock Text="Ð¡ÐµÑÑÐ¸Ñ:"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding SessionIds}"
                              Margin="5"
                              SelectedItem="{Binding SelectedSessionId}"
                              Style="{StaticResource LogLevelComboBoxStyle}"
                              MinWidth="280"/>
                </StackPanel>

                <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ LogLevel -->
                <StackPanel Grid.Column="6" Orientation="Horizontal">
                    <TextBlock Text="Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ:"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding LogLevels}"
                              Margin="5"
                              SelectedItem="{Binding SelectedLogLevel}"
                              DisplayMemberPath="DisplayName"
                              Style="{StaticResource LogLevelComboBoxStyle}"/>
                </StackPanel>

                <!-- Auto-scroll -->
                <CheckBox Grid.Column="7"
                          Foreground="White"
                          Content="ÐÐ²Ñ‚Ð¾-Ð¿Ñ€Ð¾ÐºÑ€ÑƒÑ‚ÐºÐ°"
                          IsChecked="{Binding AutoScroll}"
                          VerticalAlignment="Center"
                          Margin="20,0,0,0"/>
            </Grid>
        </hc:Card>

        <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð»Ð¾Ð³Ð¾Ð² -->
        <hc:Card Grid.Row="2" Background="#0C0C0C" BorderThickness="1" BorderBrush="#1E1E1E">
            <DataGrid ItemsSource="{Binding FilteredLogs}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserSortColumns="False"
                      GridLinesVisibility="None"
                      HeadersVisibility="Column"
                      RowHeaderWidth="0"
                      EnableRowVirtualization="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      ScrollViewer.CanContentScroll="True"
                      Background="#0C0C0C"
                      Foreground="#CCCCCC"
                      BorderThickness="0">

                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#1E1E1E"/>
                        <Setter Property="Foreground" Value="#CCCCCC"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontFamily" Value="Consolas"/>
                        <Setter Property="Padding" Value="10,5"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                        <Setter Property="BorderBrush" Value="#3E3E42"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Foreground" Value="#CCCCCC"/>
                        <Setter Property="Padding" Value="10,5"/>
                        <Setter Property="FontFamily" Value="Consolas"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.CellStyle>

                <DataGrid.Columns>

                    <!-- Ð’Ñ€ÐµÐ¼Ñ -->
                    <DataGridTemplateColumn Header="Ð’Ñ€ÐµÐ¼Ñ" Width="110" CanUserSort="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="models:LogEntryViewModel">
                                <Border 
                                        CornerRadius="3"
                                        Padding="8,4"
                                        Height="30"
                                        HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding TimeFormatted}"
                                               Foreground="White"
                                               FontWeight="SemiBold"
                                               FontSize="11"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ -->
                    <DataGridTemplateColumn Header="Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ" Width="110" CanUserSort="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="models:LogEntryViewModel">
                                <Border Background="{Binding Level, Converter={StaticResource LogLevelToBrushConverter}}"
                                        CornerRadius="3"
                                        Padding="8,4"
                                        Height="30"
                                        HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding LevelText}"
                                               Foreground="White"
                                               FontWeight="SemiBold"
                                               FontSize="11"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ -->
                    <DataGridTextColumn Header="ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
                                        Binding="{Binding Application}"
                                        Width="150"
                                        CanUserSort="False"
                                        FontWeight="SemiBold"/>

                    <!-- SessionId -->
                    <DataGridTextColumn Header="Ð¡ÐµÑÑÐ¸Ñ"
                                        Binding="{Binding SessionIdShort}"
                                        Width="90"
                                        CanUserSort="False"
                                        FontFamily="Consolas"
                                        FontSize="11"/>

                    <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                    <DataGridTextColumn Header="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ"
                                        Binding="{Binding Category}"
                                        Width="200"
                                        CanUserSort="False"/>

                    <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ -->
                    <DataGridTemplateColumn Header="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ" Width="*" CanUserSort="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="models:LogEntryViewModel">
                                <StackPanel>
                                    <TextBlock Text="{Binding Message}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Exception}"
                                               Foreground="#FF6B6B"
                                               FontFamily="Consolas"
                                               FontSize="10"
                                               TextWrapping="Wrap"
                                               Margin="0,5,0,0"
                                               Visibility="{Binding HasException, Converter={StaticResource Boolean2VisibilityConverter}}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="#0C0C0C"/>
                        <Setter Property="Foreground" Value="#CCCCCC"/>
                        <Setter Property="Height" Value="Auto"/>
                        <Setter Property="MinHeight" Value="30"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1A1A1A"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#264F78"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </hc:Card>

        <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ-Ð±Ð°Ñ€ -->
        <hc:Card Grid.Row="3" Margin="0,15,0,0" Padding="15,10" Background="#1E1E1E">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" VerticalAlignment="Center" Foreground="#CCCCCC" FontFamily="Consolas">
                    <Run Text="Ð’ÑÐµÐ³Ð¾ Ð»Ð¾Ð³Ð¾Ð²:"/>
                    <Run Text="{Binding TotalLogsCount, Mode=OneWay}" FontWeight="Bold" Foreground="White"/>
                    <Run Text=" | ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¾:"/>
                    <Run Text="{Binding FilteredLogs.Count, Mode=OneWay}" FontWeight="Bold" Foreground="White"/>
                </TextBlock>

                <TextBlock Grid.Column="1"
                           Text="Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Prism + HandyControl"
                           Foreground="#808080"
                           FontSize="11"
                           FontFamily="Consolas"
                           VerticalAlignment="Center"/>
            </Grid>
        </hc:Card>
    </Grid>
</UserControl>
